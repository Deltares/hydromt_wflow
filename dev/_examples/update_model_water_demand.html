
<!DOCTYPE html>


<html lang="en" data-content_root="../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Update a wflow model: water demand &#8212; HydroMT Wflow  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../_static/theme-deltares.css?v=5ca2d357" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_examples/update_model_water_demand';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://raw.githubusercontent.com/Deltares/hydromt_wflow/gh-pages/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '1.0.0';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <link rel="icon" href="../_static/hydromt-icon.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Connect Wflow to a 1D model" href="connect_to_1d_model.html" />
    <link rel="prev" title="Update a Wflow model: gauging stations" href="update_model_gauges.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="1.0.0.dev" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
    
    <img src="../_static/hydromt-icon.svg" class="logo__image only-light" alt=""/>
    <img src="../_static/hydromt-icon.svg" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">HydroMT Wflow</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting_started/intro.html">
    Getting started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../user_guide/intro.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../dev_guide/intro.html">
    Developments
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://deltares.github.io/hydromt/latest/index.html">
    HydroMT core
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Deltares/hydromt_wflow" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://deltares.github.io/Wflow.jl/dev/" title="Wflow" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../_static/wflow_logo.png" class="icon-link-image" alt="Wflow"/></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.deltares.nl/en/" title="Deltares" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../_static/deltares-blue.svg" class="icon-link-image" alt="Deltares"/></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting_started/intro.html">
    Getting started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../user_guide/intro.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../dev_guide/intro.html">
    Developments
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://deltares.github.io/hydromt/latest/index.html">
    HydroMT core
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Deltares/hydromt_wflow" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://deltares.github.io/Wflow.jl/dev/" title="Wflow" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../_static/wflow_logo.png" class="icon-link-image" alt="Wflow"/></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.deltares.nl/en/" title="Deltares" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../_static/deltares-blue.svg" class="icon-link-image" alt="Deltares"/></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../user_guide/wflow.html">Working with the Wflow model</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../user_guide/wflow_model_setup.html">Model methods and components</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../user_guide/wflow_build.html">Building a model</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="build_model.html">Example: Build Wflow model</a></li>
</ul>
</details></li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="../user_guide/wflow_update.html">Updating a model</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="update_model_landuse.html">Example: Update Wflow model (landuse)</a></li>
<li class="toctree-l3"><a class="reference internal" href="update_model_forcing.html">Example: Update Wflow model (forcing)</a></li>
<li class="toctree-l3"><a class="reference internal" href="update_model_gauges.html">Example: Update Wflow model (gauges)</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">Example: Update Wflow model with water demand</a></li>
<li class="toctree-l3"><a class="reference internal" href="connect_to_1d_model.html">Example: Connect Wflow to a 1D river model</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../user_guide/wflow_clip.html">Clipping a model</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="clip_model.html">Example: Clip Wflow model</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../user_guide/sediment.html">Working with the Wflow Sediment model</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/sediment_model_setup.html">Model methods and components</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../user_guide/sediment_build.html">Building a model</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="build_sediment.html">Example: Build Wflow Sediment model</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/sediment_update.html">Updating a model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/sediment_clip.html">Clipping a model</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../user_guide/process_analyze.html">Pre and postprocessing and visualization</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="prepare_ldd.html">Prepare flow directions and related data from a DEM</a></li>

<li class="toctree-l2"><a class="reference internal" href="convert_staticmaps_to_mapstack.html">Example: Convert wflow staticmaps netcdf to raster files</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_wflow_staticmaps.html">Example: Plot Wflow staticmaps</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_wflow_forcing.html">Example: Plot Wflow forcing data</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_wflow_results.html">Example: Plot Wflow results data</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrade_to_wflow_v1.html">Example: Upgrade to Wflow.jl version 1</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../user_guide/intro.html" class="nav-link">User guide</a></li>
    
    
    <li class="breadcrumb-item"><a href="../user_guide/wflow.html" class="nav-link">Working with the Wflow model</a></li>
    
    
    <li class="breadcrumb-item"><a href="../user_guide/wflow_update.html" class="nav-link">Updating a model</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Update a wflow model: water demand</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="admonition tip">
<p class="admonition-title">Tip</p>
<div>
    For an interactive online version click here:
    <a href="https://mybinder.org/v2/gh/Deltares/hydromt_wflow/main?urlpath=lab/tree/examples/update_model_water_demand.ipynb" target="_blank" rel="noopener noreferrer"><img alt="Binder badge" src="https://mybinder.org/badge_logo.svg"></a>
</div></div>
<section id="Update-a-wflow-model:-water-demand">
<h1>Update a wflow model: water demand<a class="headerlink" href="#Update-a-wflow-model:-water-demand" title="Link to this heading">#</a></h1>
<p>With HydroMT, you can easily read your model and update one or several components of your model using the <strong>update</strong> function of the command line interface (CLI). Here are the steps and some examples on how to <strong>add water demand information</strong> to your wflow_sbm model.</p>
<p>All lines in this notebook which starts with ! are executed from the command line. Within the notebook environment the logging messages are shown after completion. You can also copy these lines and paste them in your shell to get more feedback.</p>
<p>You can update a wflow_sbm model to include the simulation of water demand and allocation. This can be important in basins where there is substantial human influence, and/or you might want to simulate what will happen if (more) water is consumed. We identify four different sources of water demand:</p>
<ul class="simple">
<li><p>domestic</p></li>
<li><p>industry</p></li>
<li><p>livestock</p></li>
<li><p>irrigation</p></li>
</ul>
<p>These four different items are taken into account when adding the required water demand data to your wflow model. Besides computing the water demand, we also need information on the regions where water is allocated.</p>
<p>Let’s open the example configuration file (<strong>wflow_update_water_demand.yml</strong>) from the model repository [examples folder] and have a look at the main setup.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fn_config</span> <span class="o">=</span> <span class="s2">&quot;wflow_update_water_demand.yml&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn_config</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
setup_allocation_areas:
  waterareas_fn: gadm_level2
  priority_basins: True
  output_name: allocation_areas_admin2

setup_allocation_surfacewaterfrac:
  gwfrac_fn: lisflood_gwfrac
  gwbodies_fn: lisflood_gwbodies
  ncfrac_fn: lisflood_ncfrac

# Update model with GLCNMO landuse data in order to add the paddies
setup_lulcmaps_with_paddy:
  lulc_fn: glcnmo
  paddy_class: 12
  soil_fn: soilgrids
  wflow_thicknesslayers:
    - 50
    - 100
    - 50
    - 200
    - 800
  target_conductivity:
    - null
    - null
    - 5
    - null
    - null
  paddy_waterlevels:
    &#34;demand_paddy_h_min&#34;: 20
    &#34;demand_paddy_h_opt&#34;: 50
    &#34;demand_paddy_h_max&#34;: 80

setup_domestic_demand:
  domestic_fn: pcr_globwb
  population_fn: ghs_pop_2015
  domestic_fn_original_res: 0.5

setup_other_demand:
  demand_fn: pcr_globwb
  variables:
    - industry_gross
    - industry_net
    - livestock_gross
    - livestock_net
  resampling_method: nearest

setup_irrigation:
  irrigated_area_fn: irrigated_area
  irrigation_value:
    - 1
  cropland_class:
    - 11
    - 14
    - 20
    - 30
  paddy_class:
    - 12
  area_threshold: 0.6
  lai_threshold: 0.2
  lulcmap_name: meta_landuse

</pre></div></div>
</div>
<p>Here, you see we will be adding the required information to simulate water demand and allocation in wflow, by running three different setup functions:</p>
<ul class="simple">
<li><p><strong>setup_allocation_areas</strong>: Adds a map that defines the different regions that will be used to allocate water. By default this is a mix between administrative boundaries and catchment boundaries</p></li>
<li><p><strong>setup_allocation_surfacewaterfrac</strong>: prepare the fraction of surface water used for allocation (can be reduced if groundwater or non conventional water sources are also present in the basin).</p></li>
<li><p><strong>setup_lulcmaps_with_paddy</strong> (or <strong>setup_lulcmaps</strong>): update the landuse to include new parameters (crop factor and soil water pressure heads from feddes) and add the paddies (rice fields). To allow for water to pool on the surface of the rice fields, soil parameters will also be updated to include an additional thin layer with limited vertical conductivity.</p></li>
<li><p><strong>setup_domestic_demand</strong>: Add domestic water demands (gross and net) from gridded data and downscaled using high resolution population map.</p></li>
<li><p><strong>setup_other_demand</strong>: Adds maps to the wflow schematization that describe how much water is demanded (gross and net amounts) by different sources: domestic (dom), industry (ind), and livestock (lsk). In our case, as we downscale domestic with population, we will here add industry and livestock.</p></li>
<li><p><strong>setup_irrigation</strong>: Adds information about where and when irrigation takes place for paddy and nonpaddy crops.</p></li>
</ul>
<p>More information on these steps will be given below (after we have updated the model)</p>
<section id="Update-the-wflow-model">
<h2>Update the wflow model<a class="headerlink" href="#Update-the-wflow-model" title="Link to this heading">#</a></h2>
<p>First, we build a wflow_sbm model for the full Piave basin, as most water demand activities occur in the most downstream locations of the catchment. Please note that this is a basin model (until the full outlet at the ocean), as opposed to the sub-basin models (until a certain location) that are being created in the other examples.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NOTE: copy this line (without !) to your shell for more direct feedback</span>
<span class="o">!</span><span class="w"> </span>hydromt<span class="w"> </span>build<span class="w"> </span>wflow<span class="w"> </span><span class="s2">&quot;./wflow_piave_basin&quot;</span><span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;{&#39;basin&#39;: [12.2051, 45.8331], &#39;bounds&#39;: [11.70, 45.35, 12.95, 46.70]}&quot;</span><span class="w"> </span>-i<span class="w"> </span>wflow_build.yml<span class="w"> </span>-d<span class="w"> </span>artifact_data<span class="w"> </span>-vv
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2025-08-18 13:40:15,544 - build - log - DEBUG - Writing log messages to new file /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/wflow_piave_basin/hydromt.log.
2025-08-18 13:40:15,544 - build - log - INFO - HydroMT version: 0.10.1
2025-08-18 13:40:15,544 - build - main - INFO - Building instance of wflow model at /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/wflow_piave_basin.
2025-08-18 13:40:15,544 - build - main - INFO - User settings:
2025-08-18 13:40:15,605 - build - data_catalog - INFO - Reading data catalog artifact_data latest
2025-08-18 13:40:15,605 - build - data_catalog - INFO - Parsing data catalog from /home/runner/.hydromt_data/artifact_data/v0.0.9/data_catalog.yml
2025-08-18 13:40:16,162 - build - model_api - INFO - Initializing wflow model from hydromt_wflow (v1.0.0.dev0).
2025-08-18 13:40:16,162 - build - data_catalog - INFO - Parsing data catalog from /home/runner/work/hydromt_wflow/hydromt_wflow/hydromt_wflow/data/parameters_data.yml
2025-08-18 13:40:16,174 - build - wflow - INFO - Supported Wflow.jl version v1+
2025-08-18 13:40:16,179 - build - model_api - DEBUG - Default config read from /home/runner/work/hydromt_wflow/hydromt_wflow/hydromt_wflow/data/wflow/wflow_sbm.toml
2025-08-18 13:40:16,180 - build - model_api - DEBUG - Setting model config options.
2025-08-18 13:40:16,181 - build - model_api - INFO - setup_basemaps.region: {&#39;basin&#39;: [12.2051, 45.8331], &#39;bounds&#39;: [11.7, 45.35, 12.95, 46.7]}
2025-08-18 13:40:16,181 - build - model_api - INFO - setup_basemaps.hydrography_fn: merit_hydro
2025-08-18 13:40:16,181 - build - model_api - INFO - setup_basemaps.basin_index_fn: merit_hydro_index
2025-08-18 13:40:16,181 - build - model_api - INFO - setup_basemaps.res: 0.00833
2025-08-18 13:40:16,181 - build - model_api - INFO - setup_basemaps.upscale_method: ihu
2025-08-18 13:40:16,181 - build - model_api - INFO - setup_basemaps.output_names: {&#39;basin__local_drain_direction&#39;: &#39;local_drain_direction&#39;, &#39;subbasin_location__count&#39;: &#39;subcatchment&#39;, &#39;land_surface__slope&#39;: &#39;land_slope&#39;}
2025-08-18 13:40:16,181 - build - wflow - INFO - Preparing base hydrography basemaps.
2025-08-18 13:40:16,182 - build - rasterdataset - INFO - Reading merit_hydro raster data from /home/runner/.hydromt_data/artifact_data/v0.0.9/data.tar/merit_hydro/{variable}.tif
2025-08-18 13:40:16,369 - build - basin_mask - DEBUG - Parsed region (kind=basin): {&#39;bounds&#39;: [11.7, 45.35, 12.95, 46.7], &#39;xy&#39;: [12.2051, 45.8331]}
2025-08-18 13:40:16,383 - build - basin_mask - DEBUG - Getting basin IDs at point locations.
2025-08-18 13:40:16,509 - build - basin_mask - INFO - basin bbox: [11.7750, 45.5042, 12.8375, 46.6900]
2025-08-18 13:40:16,575 - build - wflow - DEBUG - Adding basins vector to geoms.
2025-08-18 13:40:16,576 - build - basemaps - DEBUG - (Sub)basin at original resolution has 751509 cells.
2025-08-18 13:40:17,355 - build - basemaps - INFO - Upscale flow direction data: 10x, ihu method.
2025-08-18 13:40:31,856 - build - basemaps - DEBUG - Derive stream order.
2025-08-18 13:40:32,023 - build - basemaps - DEBUG - Map shape: (142, 127); active cells: 7503.
2025-08-18 13:40:32,023 - build - basemaps - DEBUG - Outlet coordinates (1/1): (12.73250,45.52750).
2025-08-18 13:40:32,214 - build - wflow - DEBUG - Adding region vector to geoms.
2025-08-18 13:40:32,217 - build - model_api - INFO - setup_rivers.hydrography_fn: merit_hydro
2025-08-18 13:40:32,217 - build - model_api - INFO - setup_rivers.river_geom_fn: hydro_rivers_lin
2025-08-18 13:40:32,217 - build - model_api - INFO - setup_rivers.river_upa: 30
2025-08-18 13:40:32,217 - build - model_api - INFO - setup_rivers.rivdph_method: powlaw
2025-08-18 13:40:32,217 - build - model_api - INFO - setup_rivers.slope_len: 2000
2025-08-18 13:40:32,217 - build - model_api - INFO - setup_rivers.min_rivlen_ratio: 0.0
2025-08-18 13:40:32,217 - build - model_api - INFO - setup_rivers.min_rivdph: 1
2025-08-18 13:40:32,217 - build - model_api - INFO - setup_rivers.min_rivwth: 30
2025-08-18 13:40:32,217 - build - model_api - INFO - setup_rivers.smooth_len: 5000
2025-08-18 13:40:32,217 - build - model_api - INFO - setup_rivers.rivman_mapping_fn: roughness_river_mapping_default
2025-08-18 13:40:32,217 - build - model_api - INFO - setup_rivers.elevtn_map: land_elevation
2025-08-18 13:40:32,217 - build - model_api - INFO - setup_rivers.river_routing: kinematic-wave
2025-08-18 13:40:32,217 - build - model_api - INFO - setup_rivers.connectivity: 8
2025-08-18 13:40:32,218 - build - model_api - INFO - setup_rivers.strord_name: meta_streamorder
2025-08-18 13:40:32,218 - build - model_api - INFO - setup_rivers.output_names: {&#39;river_location__mask&#39;: &#39;river_mask&#39;, &#39;river__length&#39;: &#39;river_length&#39;, &#39;river__width&#39;: &#39;river_width&#39;, &#39;river_bank_water__depth&#39;: &#39;river_depth&#39;, &#39;river__slope&#39;: &#39;river_slope&#39;, &#39;river_water_flow__manning_n_parameter&#39;: &#39;river_manning_n&#39;, &#39;river_bank_water__elevation&#39;: &#39;river_bank_elevation&#39;}
2025-08-18 13:40:32,218 - build - wflow - INFO - Preparing river maps.
2025-08-18 13:40:32,219 - build - rasterdataset - INFO - Reading merit_hydro raster data from /home/runner/.hydromt_data/artifact_data/v0.0.9/data.tar/merit_hydro/{variable}.tif
2025-08-18 13:40:32,286 - build - rasterdataset - DEBUG - Clip to [11.778, 45.507, 12.837, 46.690] (epsg:4326))
2025-08-18 13:40:32,294 - build - river - DEBUG - Set river mask (min uparea: 30 km2) and prepare flow dirs.
2025-08-18 13:40:32,470 - build - river - DEBUG - Derive river length.
2025-08-18 13:40:36,699 - build - river - DEBUG - Derive river slope.
2025-08-18 13:40:37,285 - build - river - DEBUG - Derive rivwth from hydrography dataset.
2025-08-18 13:40:37,326 - build - dataframe - INFO - Reading roughness_river_mapping_default csv data from /home/runner/work/hydromt_wflow/hydromt_wflow/hydromt_wflow/data/wflow/river_manning_mapping.csv
2025-08-18 13:40:37,333 - build - landuse - INFO - Deriving river_manning_n using average resampling (nodata=-999.0).
2025-08-18 13:40:37,341 - build - geodataframe - INFO - Reading hydro_rivers_lin vector data from /home/runner/.hydromt_data/artifact_data/v0.0.9/data.tar/rivers_lin2019_v1.gpkg
2025-08-18 13:40:37,349 - build - geodataframe - DEBUG - Clip intersects [11.778, 45.507, 12.837, 46.690] (EPSG:4326)
2025-08-18 13:40:37,544 - build - river - DEBUG - Derive [&#39;rivwth&#39;, &#39;qbankfull&#39;] from shapefile.
2025-08-18 13:40:37,609 - build - river - DEBUG - Valid for 466/830 river cells (max dist: 393 m).
2025-08-18 13:40:40,331 - build - wflow - DEBUG - Adding rivers vector to geoms.
2025-08-18 13:40:40,946 - build - wflow - DEBUG - Update wflow config model.river_routing=&#34;kinematic-wave&#34;
2025-08-18 13:40:40,947 - build - model_api - INFO - setup_reservoirs_simple_control.reservoirs_fn: hydro_reservoirs
2025-08-18 13:40:40,947 - build - model_api - INFO - setup_reservoirs_simple_control.timeseries_fn: gww
2025-08-18 13:40:40,947 - build - model_api - INFO - setup_reservoirs_simple_control.overwrite_existing: False
2025-08-18 13:40:40,947 - build - model_api - INFO - setup_reservoirs_simple_control.duplicate_id: error
2025-08-18 13:40:40,947 - build - model_api - INFO - setup_reservoirs_simple_control.min_area: 1.0
2025-08-18 13:40:40,947 - build - model_api - INFO - setup_reservoirs_simple_control.output_names: {&#39;reservoir_area__count&#39;: &#39;reservoir_area_id&#39;, &#39;reservoir_location__count&#39;: &#39;reservoir_outlet_id&#39;, &#39;reservoir_surface__area&#39;: &#39;reservoir_area&#39;, &#39;reservoir_water_surface__initial_elevation&#39;: &#39;reservoir_initial_depth&#39;, &#39;reservoir_water__rating_curve_type_count&#39;: &#39;reservoir_rating_curve&#39;, &#39;reservoir_water__storage_curve_type_count&#39;: &#39;reservoir_storage_curve&#39;, &#39;reservoir_water__max_volume&#39;: &#39;reservoir_max_volume&#39;, &#39;reservoir_water~min-target__volume_fraction&#39;: &#39;reservoir_target_min_fraction&#39;, &#39;reservoir_water~full-target__volume_fraction&#39;: &#39;reservoir_target_full_fraction&#39;, &#39;reservoir_water_demand~required~downstream__volume_flow_rate&#39;: &#39;reservoir_demand&#39;, &#39;reservoir_water_release-below-spillway__max_volume_flow_rate&#39;: &#39;reservoir_max_release&#39;}
2025-08-18 13:40:40,947 - build - model_api - INFO - setup_reservoirs_simple_control.geom_name: meta_reservoirs_simple_control
2025-08-18 13:40:40,947 - build - wflow - INFO - Preparing reservoir with simple control maps.
2025-08-18 13:40:40,947 - build - geodataframe - INFO - Reading hydro_reservoirs vector data from /home/runner/.hydromt_data/artifact_data/v0.0.9/data.tar/hydro_reservoirs.gpkg
2025-08-18 13:40:40,964 - build - geodataframe - DEBUG - Clip contains [11.775, 45.504, 12.838, 46.690] (EPSG:4326)
2025-08-18 13:40:40,966 - build - geodataframe - DEBUG - Convert units for 5 columns.
2025-08-18 13:40:40,968 - build - reservoirs - INFO - 0 reservoir(s) of sufficient size found within region.
2025-08-18 13:40:40,968 - build - model_api - INFO - setup_reservoirs_no_control.reservoirs_fn: hydro_lakes
2025-08-18 13:40:40,968 - build - model_api - INFO - setup_reservoirs_no_control.rating_curve_fns: None
2025-08-18 13:40:40,968 - build - model_api - INFO - setup_reservoirs_no_control.overwrite_existing: False
2025-08-18 13:40:40,968 - build - model_api - INFO - setup_reservoirs_no_control.duplicate_id: error
2025-08-18 13:40:40,968 - build - model_api - INFO - setup_reservoirs_no_control.min_area: 10.0
2025-08-18 13:40:40,968 - build - model_api - INFO - setup_reservoirs_no_control.output_names: {&#39;reservoir_area__count&#39;: &#39;reservoir_area_id&#39;, &#39;reservoir_location__count&#39;: &#39;reservoir_outlet_id&#39;, &#39;reservoir_surface__area&#39;: &#39;reservoir_area&#39;, &#39;reservoir_water_surface__initial_elevation&#39;: &#39;reservoir_initial_depth&#39;, &#39;reservoir_water_flow_threshold-level__elevation&#39;: &#39;reservoir_outflow_threshold&#39;, &#39;reservoir_water__rating_curve_coefficient&#39;: &#39;reservoir_b&#39;, &#39;reservoir_water__rating_curve_exponent&#39;: &#39;reservoir_e&#39;, &#39;reservoir_water__rating_curve_type_count&#39;: &#39;reservoir_rating_curve&#39;, &#39;reservoir_water__storage_curve_type_count&#39;: &#39;reservoir_storage_curve&#39;, &#39;reservoir~lower_location__count&#39;: &#39;reservoir_lower_id&#39;}
2025-08-18 13:40:40,968 - build - model_api - INFO - setup_reservoirs_no_control.geom_name: meta_reservoirs_no_control
2025-08-18 13:40:40,968 - build - wflow - INFO - Preparing reservoir maps.
2025-08-18 13:40:40,968 - build - geodataframe - INFO - Reading hydro_lakes vector data from /home/runner/.hydromt_data/artifact_data/v0.0.9/data.tar/hydro_lakes.gpkg
2025-08-18 13:40:40,978 - build - geodataframe - DEBUG - Clip contains [11.775, 45.504, 12.838, 46.690] (EPSG:4326)
2025-08-18 13:40:40,980 - build - geodataframe - DEBUG - Convert units for 1 columns.
2025-08-18 13:40:40,981 - build - reservoirs - INFO - 0 reservoir(s) of sufficient size found within region.
2025-08-18 13:40:40,981 - build - model_api - INFO - setup_glaciers.glaciers_fn: rgi
2025-08-18 13:40:40,981 - build - model_api - INFO - setup_glaciers.min_area: 0.0
2025-08-18 13:40:40,981 - build - model_api - INFO - setup_glaciers.output_names: {&#39;glacier_surface__area_fraction&#39;: &#39;glacier_fraction&#39;, &#39;glacier_ice__initial_leq-depth&#39;: &#39;glacier_initial_leq_depth&#39;}
2025-08-18 13:40:40,981 - build - model_api - INFO - setup_glaciers.geom_name: glaciers
2025-08-18 13:40:40,981 - build - wflow - INFO - Preparing glacier maps.
2025-08-18 13:40:40,981 - build - geodataframe - INFO - Reading rgi vector data from /home/runner/.hydromt_data/artifact_data/v0.0.9/data.tar/rgi.gpkg
2025-08-18 13:40:40,993 - build - geodataframe - DEBUG - Clip intersects [11.775, 45.504, 12.838, 46.690] (EPSG:4326)
2025-08-18 13:40:40,995 - build - wflow - INFO - 38 glaciers of sufficient size found within region.
2025-08-18 13:40:42,049 - build - model_api - INFO - setup_lulcmaps.lulc_fn: globcover_2009
2025-08-18 13:40:42,049 - build - model_api - INFO - setup_lulcmaps.lulc_mapping_fn: globcover_mapping_default
2025-08-18 13:40:42,049 - build - model_api - INFO - setup_lulcmaps.lulc_vars: {&#39;landuse&#39;: None, &#39;vegetation_kext&#39;: &#39;vegetation_canopy__light-extinction_coefficient&#39;, &#39;land_manning_n&#39;: &#39;land_surface_water_flow__manning_n_parameter&#39;, &#39;soil_compacted_fraction&#39;: &#39;soil~compacted__area_fraction&#39;, &#39;vegetation_root_depth&#39;: &#39;vegetation_root__depth&#39;, &#39;vegetation_leaf_storage&#39;: &#39;vegetation__specific-leaf_storage&#39;, &#39;vegetation_wood_storage&#39;: &#39;vegetation_wood_water__storage_capacity&#39;, &#39;land_water_fraction&#39;: &#39;land~water-covered__area_fraction&#39;, &#39;vegetation_crop_factor&#39;: &#39;vegetation__crop_factor&#39;, &#39;vegetation_feddes_alpha_h1&#39;: &#39;vegetation_root__feddes_critial_pressure_head_h~1_reduction_coefficient&#39;, &#39;vegetation_feddes_h1&#39;: &#39;vegetation_root__feddes_critial_pressure_head_h~1&#39;, &#39;vegetation_feddes_h2&#39;: &#39;vegetation_root__feddes_critial_pressure_head_h~2&#39;, &#39;vegetation_feddes_h3_high&#39;: &#39;vegetation_root__feddes_critial_pressure_head_h~3~high&#39;, &#39;vegetation_feddes_h3_low&#39;: &#39;vegetation_root__feddes_critial_pressure_head_h~3~low&#39;, &#39;vegetation_feddes_h4&#39;: &#39;vegetation_root__feddes_critial_pressure_head_h~4&#39;}
2025-08-18 13:40:42,049 - build - model_api - INFO - setup_lulcmaps.output_names_suffix: None
2025-08-18 13:40:42,049 - build - wflow - INFO - Preparing LULC parameter maps.
2025-08-18 13:40:42,050 - build - rasterdataset - INFO - Reading globcover_2009 raster data from /home/runner/.hydromt_data/artifact_data/v0.0.9/data.tar/globcover.tif
2025-08-18 13:40:42,059 - build - rasterdataset - DEBUG - Clip to [11.778, 45.507, 12.837, 46.690] (epsg:4326))
2025-08-18 13:40:42,060 - build - dataframe - INFO - Reading globcover_mapping_default csv data from /home/runner/work/hydromt_wflow/hydromt_wflow/hydromt_wflow/data/lulc/globcover_mapping.csv
2025-08-18 13:40:42,068 - build - landuse - INFO - Deriving landuse using nearest resampling (nodata=230).
2025-08-18 13:40:42,095 - build - landuse - INFO - Deriving vegetation_kext using average resampling (nodata=-999.0).
2025-08-18 13:40:42,119 - build - landuse - INFO - Deriving land_manning_n using average resampling (nodata=-999.0).
2025-08-18 13:40:42,144 - build - landuse - INFO - Deriving soil_compacted_fraction using average resampling (nodata=-999.0).
2025-08-18 13:40:42,168 - build - landuse - INFO - Deriving vegetation_root_depth using average resampling (nodata=-999.0).
2025-08-18 13:40:42,194 - build - landuse - INFO - Deriving vegetation_leaf_storage using average resampling (nodata=-999.0).
2025-08-18 13:40:42,218 - build - landuse - INFO - Deriving vegetation_wood_storage using average resampling (nodata=-999.0).
2025-08-18 13:40:42,243 - build - landuse - INFO - Deriving land_water_fraction using average resampling (nodata=-999.0).
2025-08-18 13:40:42,267 - build - landuse - INFO - Deriving vegetation_crop_factor using average resampling (nodata=-999.0).
2025-08-18 13:40:42,293 - build - landuse - INFO - Deriving vegetation_feddes_alpha_h1 using mode resampling (nodata=-999).
2025-08-18 13:40:42,374 - build - landuse - INFO - Deriving vegetation_feddes_h1 using average resampling (nodata=-999).
2025-08-18 13:40:42,403 - build - landuse - INFO - Deriving vegetation_feddes_h2 using average resampling (nodata=-999).
2025-08-18 13:40:42,431 - build - landuse - INFO - Deriving vegetation_feddes_h3_high using average resampling (nodata=-999).
2025-08-18 13:40:42,458 - build - landuse - INFO - Deriving vegetation_feddes_h3_low using average resampling (nodata=-999).
2025-08-18 13:40:42,487 - build - landuse - INFO - Deriving vegetation_feddes_h4 using average resampling (nodata=-999).
2025-08-18 13:40:42,543 - build - model_api - INFO - setup_laimaps.lai_fn: modis_lai
2025-08-18 13:40:42,543 - build - model_api - INFO - setup_laimaps.lulc_fn: None
2025-08-18 13:40:42,543 - build - model_api - INFO - setup_laimaps.lulc_sampling_method: any
2025-08-18 13:40:42,543 - build - model_api - INFO - setup_laimaps.lulc_zero_classes: []
2025-08-18 13:40:42,543 - build - model_api - INFO - setup_laimaps.buffer: 2
2025-08-18 13:40:42,543 - build - model_api - INFO - setup_laimaps.output_name: vegetation_leaf_area_index
2025-08-18 13:40:42,543 - build - wflow - INFO - Preparing LAI maps.
2025-08-18 13:40:42,543 - build - rasterdataset - INFO - Reading modis_lai netcdf data from /home/runner/.hydromt_data/artifact_data/v0.0.9/data.tar/modis_lai.nc
2025-08-18 13:40:43,006 - build - rasterdataset - DEBUG - Clip to [11.778, 45.507, 12.837, 46.690] (epsg:4326))
2025-08-18 13:40:43,008 - build - rasterdataset - DEBUG - Convert units for 1 variables.
2025-08-18 13:40:43,012 - build - landuse - INFO - Deriving LAI using average resampling (nodata=nan).
2025-08-18 13:40:43,098 - build - model_api - INFO - setup_soilmaps.soil_fn: soilgrids
2025-08-18 13:40:43,098 - build - model_api - INFO - setup_soilmaps.ptf_ksatver: brakensiek
2025-08-18 13:40:43,099 - build - model_api - INFO - setup_soilmaps.wflow_thicknesslayers: [100, 300, 800]
2025-08-18 13:40:43,099 - build - model_api - INFO - setup_soilmaps.output_names: {&#39;soil_water__saturated_volume_fraction&#39;: &#39;soil_theta_s&#39;, &#39;soil_water__residual_volume_fraction&#39;: &#39;soil_theta_r&#39;, &#39;soil_surface_water__vertical_saturated_hydraulic_conductivity&#39;: &#39;soil_ksat_vertical&#39;, &#39;soil__thickness&#39;: &#39;soil_thickness&#39;, &#39;soil_water__vertical_saturated_hydraulic_conductivity_scale_parameter&#39;: &#39;soil_f&#39;, &#39;soil_layer_water__brooks-corey_exponent&#39;: &#39;soil_brooks_corey_c&#39;}
2025-08-18 13:40:43,099 - build - wflow - INFO - Preparing soil parameter maps.
2025-08-18 13:40:43,100 - build - rasterdataset - INFO - Reading soilgrids raster data from /home/runner/.hydromt_data/artifact_data/v0.0.9/data.tar/soilgrids/{variable}.tif
2025-08-18 13:40:43,402 - build - rasterdataset - DEBUG - Clip to [11.778, 45.507, 12.837, 46.690] (epsg:4326))
2025-08-18 13:40:43,413 - build - rasterdataset - DEBUG - Convert units for 21 variables.
2025-08-18 13:40:43,626 - build - soilgrids - INFO - calculate and resample theta_s
2025-08-18 13:40:43,847 - build - soilgrids - INFO - calculate and resample theta_r
2025-08-18 13:40:44,296 - build - soilgrids - INFO - calculate and resample ksat_vertical
2025-08-18 13:40:44,362 - build - soilgrids - INFO - calculate and resample pore size distribution index
2025-08-18 13:40:44,877 - build - soilgrids - INFO - fit z - log(ksat_vertical ) with numpy linalg regression (y = b*x) -&gt; M_
2025-08-18 13:40:45,445 - build - soilgrids - INFO - fit zi - Ksat with curve_fit (scipy.optimize) -&gt; M
2025-08-18 13:40:49,104 - build - soilgrids - DEBUG - Interpolate nodata (NaN) values for theta_s
2025-08-18 13:40:49,219 - build - soilgrids - DEBUG - Interpolate nodata (NaN) values for theta_r
2025-08-18 13:40:49,353 - build - soilgrids - DEBUG - Interpolate nodata (NaN) values for soil_thickness
No numerical nodata value found, skipping set_nodata
2025-08-18 13:40:49,371 - build - soilgrids - DEBUG - Interpolate nodata (NaN) values for soil_brooks_corey_c
2025-08-18 13:40:49,380 - build - soilgrids - DEBUG - Interpolate nodata (NaN) values for ksat_vertical
2025-08-18 13:40:49,432 - build - soilgrids - DEBUG - Interpolate nodata (NaN) values for meta_soilgrids_ksat_vertical_0.0cm
2025-08-18 13:40:49,486 - build - soilgrids - DEBUG - Interpolate nodata (NaN) values for meta_soilgrids_ksat_vertical_5.0cm
2025-08-18 13:40:49,536 - build - soilgrids - DEBUG - Interpolate nodata (NaN) values for meta_soilgrids_ksat_vertical_15.0cm
2025-08-18 13:40:49,586 - build - soilgrids - DEBUG - Interpolate nodata (NaN) values for meta_soilgrids_ksat_vertical_30.0cm
2025-08-18 13:40:49,640 - build - soilgrids - DEBUG - Interpolate nodata (NaN) values for meta_soilgrids_ksat_vertical_60.0cm
2025-08-18 13:40:49,690 - build - soilgrids - DEBUG - Interpolate nodata (NaN) values for meta_soilgrids_ksat_vertical_100.0cm
2025-08-18 13:40:49,743 - build - soilgrids - DEBUG - Interpolate nodata (NaN) values for meta_soilgrids_ksat_vertical_200.0cm
2025-08-18 13:40:49,792 - build - soilgrids - DEBUG - Interpolate nodata (NaN) values for soil_f_
No numerical nodata value found, skipping set_nodata
2025-08-18 13:40:49,944 - build - soilgrids - DEBUG - Interpolate nodata (NaN) values for f
No numerical nodata value found, skipping set_nodata
2025-08-18 13:40:50,097 - build - soilgrids - DEBUG - Interpolate nodata (NaN) values for meta_soil_texture
2025-08-18 13:40:50,217 - build - model_api - INFO - setup_outlets.river_only: True
2025-08-18 13:40:50,217 - build - model_api - INFO - setup_outlets.toml_output: csv
2025-08-18 13:40:50,217 - build - model_api - INFO - setup_outlets.gauge_toml_header: [&#39;river_q&#39;]
2025-08-18 13:40:50,217 - build - model_api - INFO - setup_outlets.gauge_toml_param: [&#39;river_water__volume_flow_rate&#39;]
2025-08-18 13:40:50,218 - build - wflow - INFO - Gauges locations set based on river outlets.
2025-08-18 13:40:50,223 - build - wflow - INFO - Gauges map based on catchment river outlets added.
2025-08-18 13:40:50,223 - build - wflow - INFO - Adding [&#39;river_water__volume_flow_rate&#39;] to csv section of toml.
2025-08-18 13:40:50,224 - build - model_api - INFO - setup_gauges.gauges_fn: grdc
2025-08-18 13:40:50,224 - build - model_api - INFO - setup_gauges.index_col: None
2025-08-18 13:40:50,224 - build - model_api - INFO - setup_gauges.snap_to_river: True
2025-08-18 13:40:50,224 - build - model_api - INFO - setup_gauges.mask: None
2025-08-18 13:40:50,225 - build - model_api - INFO - setup_gauges.snap_uparea: False
2025-08-18 13:40:50,225 - build - model_api - INFO - setup_gauges.max_dist: 10000.0
2025-08-18 13:40:50,225 - build - model_api - INFO - setup_gauges.wdw: 3
2025-08-18 13:40:50,225 - build - model_api - INFO - setup_gauges.rel_error: 0.05
2025-08-18 13:40:50,225 - build - model_api - INFO - setup_gauges.abs_error: 50.0
2025-08-18 13:40:50,225 - build - model_api - INFO - setup_gauges.fillna: False
2025-08-18 13:40:50,225 - build - model_api - INFO - setup_gauges.derive_subcatch: False
2025-08-18 13:40:50,225 - build - model_api - INFO - setup_gauges.basename: None
2025-08-18 13:40:50,225 - build - model_api - INFO - setup_gauges.toml_output: csv
2025-08-18 13:40:50,225 - build - model_api - INFO - setup_gauges.gauge_toml_header: [&#39;river_q&#39;, &#39;precip&#39;]
2025-08-18 13:40:50,225 - build - model_api - INFO - setup_gauges.gauge_toml_param: [&#39;river_water__volume_flow_rate&#39;, &#39;atmosphere_water__precipitation_volume_flux&#39;]
2025-08-18 13:40:50,225 - build - geodataframe - INFO - Reading grdc csv data from /home/runner/.hydromt_data/artifact_data/v0.0.9/data.tar/grdc.csv
2025-08-18 13:40:50,230 - build - geodataframe - DEBUG - Clip intersects [11.778, 45.507, 12.837, 46.690] (EPSG:4326)
2025-08-18 13:40:50,230 - build - wflow - INFO - 3 grdc gauge locations found within domain
2025-08-18 13:40:50,842 - build - wflow - INFO - Adding [&#39;river_water__volume_flow_rate&#39;, &#39;atmosphere_water__precipitation_volume_flux&#39;] to csv section of toml.
2025-08-18 13:40:50,844 - build - model_api - INFO - setup_precip_forcing.precip_fn: era5
2025-08-18 13:40:50,844 - build - model_api - INFO - setup_precip_forcing.precip_clim_fn: None
2025-08-18 13:40:50,844 - build - model_api - INFO - setup_precip_forcing.chunksize: None
2025-08-18 13:40:50,845 - build - rasterdataset - INFO - Reading era5 netcdf data from /home/runner/.hydromt_data/artifact_data/v0.0.9/data.tar/era5.nc
2025-08-18 13:40:50,855 - build - rasterdataset - DEBUG - Shifting time labels with 86400 sec.
2025-08-18 13:40:50,856 - build - rasterdataset - DEBUG - Slicing time dim (datetime.datetime(2010, 1, 1, 0, 0), datetime.datetime(2010, 3, 31, 0, 0))
2025-08-18 13:40:50,863 - build - rasterdataset - DEBUG - Clip to [11.778, 45.507, 12.837, 46.690] (epsg:4326))
2025-08-18 13:40:50,864 - build - rasterdataset - DEBUG - Convert units for 1 variables.
2025-08-18 13:40:50,915 - build - model_api - INFO - setup_temp_pet_forcing.temp_pet_fn: era5
2025-08-18 13:40:50,915 - build - model_api - INFO - setup_temp_pet_forcing.pet_method: debruin
2025-08-18 13:40:50,915 - build - model_api - INFO - setup_temp_pet_forcing.press_correction: True
2025-08-18 13:40:50,915 - build - model_api - INFO - setup_temp_pet_forcing.temp_correction: True
2025-08-18 13:40:50,915 - build - model_api - INFO - setup_temp_pet_forcing.wind_correction: True
2025-08-18 13:40:50,915 - build - model_api - INFO - setup_temp_pet_forcing.wind_altitude: 10
2025-08-18 13:40:50,915 - build - model_api - INFO - setup_temp_pet_forcing.reproj_method: nearest_index
2025-08-18 13:40:50,915 - build - model_api - INFO - setup_temp_pet_forcing.fillna_method: None
2025-08-18 13:40:50,915 - build - model_api - INFO - setup_temp_pet_forcing.dem_forcing_fn: era5_orography
2025-08-18 13:40:50,915 - build - model_api - INFO - setup_temp_pet_forcing.skip_pet: False
2025-08-18 13:40:50,915 - build - model_api - INFO - setup_temp_pet_forcing.chunksize: None
2025-08-18 13:40:50,916 - build - rasterdataset - INFO - Reading era5 netcdf data from /home/runner/.hydromt_data/artifact_data/v0.0.9/data.tar/era5.nc
2025-08-18 13:40:50,926 - build - rasterdataset - DEBUG - Shifting time labels with 86400 sec.
2025-08-18 13:40:50,927 - build - rasterdataset - DEBUG - Slicing time dim (datetime.datetime(2010, 1, 1, 0, 0), datetime.datetime(2010, 3, 31, 0, 0))
2025-08-18 13:40:50,934 - build - rasterdataset - DEBUG - Clip to [11.778, 45.507, 12.837, 46.690] (epsg:4326))
2025-08-18 13:40:50,936 - build - rasterdataset - DEBUG - Convert units for 4 variables.
2025-08-18 13:40:50,958 - build - rasterdataset - INFO - Reading era5_orography netcdf data from /home/runner/.hydromt_data/artifact_data/v0.0.9/data.tar/era5_orography.nc
2025-08-18 13:40:50,971 - build - rasterdataset - DEBUG - Clip to [11.625, 45.375, 13.125, 46.875] (epsg:4326))
2025-08-18 13:40:50,972 - build - rasterdataset - DEBUG - Convert units for 1 variables.
2025-08-18 13:40:51,163 - build - model_api - INFO - setup_constant_pars.subsurface_water__horizontal-to-vertical_saturated_hydraulic_conductivity_ratio: 100
2025-08-18 13:40:51,163 - build - model_api - INFO - setup_constant_pars.snowpack__degree-day_coefficient: 3.75653
2025-08-18 13:40:51,163 - build - model_api - INFO - setup_constant_pars.soil_surface_water__infiltration_reduction_parameter: 0.038
2025-08-18 13:40:51,163 - build - model_api - INFO - setup_constant_pars.vegetation_canopy_water__mean_evaporation-to-mean_precipitation_ratio: 0.11
2025-08-18 13:40:51,163 - build - model_api - INFO - setup_constant_pars.soil~compacted_surface_water__infiltration_capacity: 5
2025-08-18 13:40:51,164 - build - model_api - INFO - setup_constant_pars.soil_water_sat-zone_bottom__max_leakage_volume_flux: 0
2025-08-18 13:40:51,164 - build - model_api - INFO - setup_constant_pars.soil_root~wet__sigmoid_function_shape_parameter: -500
2025-08-18 13:40:51,164 - build - model_api - INFO - setup_constant_pars.atmosphere_air__snowfall_temperature_threshold: 0
2025-08-18 13:40:51,164 - build - model_api - INFO - setup_constant_pars.atmosphere_air__snowfall_temperature_interval: 2
2025-08-18 13:40:51,164 - build - model_api - INFO - setup_constant_pars.snowpack__melting_temperature_threshold: 0
2025-08-18 13:40:51,164 - build - model_api - INFO - setup_constant_pars.snowpack__liquid_water_holding_capacity: 0.1
2025-08-18 13:40:51,164 - build - model_api - INFO - setup_constant_pars.glacier_ice__degree-day_coefficient: 5.3
2025-08-18 13:40:51,164 - build - model_api - INFO - setup_constant_pars.glacier_firn_accumulation__snowpack~dry_leq-depth_fraction: 0.002
2025-08-18 13:40:51,164 - build - model_api - INFO - setup_constant_pars.glacier_ice__melting_temperature_threshold: 1.3
2025-08-18 13:40:51,167 - build - wflow - INFO - Write model data to /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/wflow_piave_basin
2025-08-18 13:40:51,204 - build - wflow - INFO - Write grid to /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/wflow_piave_basin/staticmaps.nc
2025-08-18 13:40:51,297 - build - wflow - INFO - Writing model staticgeom to file.
2025-08-18 13:40:51,391 - build - wflow - INFO - Write forcing file
2025-08-18 13:40:51,395 - build - wflow - WARNING - Not all dates found in precip_fn changing starttime to 2010-02-02 00:00:00 and endtime to 2010-02-15 00:00:00 in the toml.
2025-08-18 13:40:51,399 - build - wflow - INFO - Process forcing; saving to /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/wflow_piave_basin/inmaps-era5-2010.nc
[########################################] | 100% Completed | 100.31 ms
2025-08-18 13:40:51,518 - build - wflow - INFO - Writing model config to /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/wflow_piave_basin/wflow_sbm.toml
</pre></div></div>
</div>
<p>Next, we will update the model using the same configuration file that was shown earlier:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>hydromt<span class="w"> </span>update<span class="w"> </span>wflow<span class="w"> </span><span class="s2">&quot;./wflow_piave_basin&quot;</span><span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;./wflow_piave_water_demand&quot;</span><span class="w"> </span>-i<span class="w"> </span>wflow_update_water_demand.yml<span class="w"> </span>-d<span class="w"> </span>artifact_data<span class="w"> </span>-d<span class="w"> </span>./data/demand/data_catalog.yml<span class="w"> </span>-v
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2025-08-18 13:40:55,221 - update - log - INFO - HydroMT version: 0.10.1
2025-08-18 13:40:55,221 - update - main - INFO - Updating wflow model at /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/wflow_piave_basin (r).
2025-08-18 13:40:55,221 - update - main - INFO - Output dir: /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/wflow_piave_water_demand
2025-08-18 13:40:55,221 - update - main - INFO - User settings:
2025-08-18 13:40:55,280 - update - data_catalog - INFO - Reading data catalog artifact_data latest
2025-08-18 13:40:55,280 - update - data_catalog - INFO - Parsing data catalog from /home/runner/.hydromt_data/artifact_data/v0.0.9/data_catalog.yml
2025-08-18 13:40:55,843 - update - data_catalog - INFO - Parsing data catalog from ./data/demand/data_catalog.yml
2025-08-18 13:40:55,848 - update - model_api - INFO - Initializing wflow model from hydromt_wflow (v1.0.0.dev0).
2025-08-18 13:40:55,848 - update - data_catalog - INFO - Parsing data catalog from /home/runner/work/hydromt_wflow/hydromt_wflow/hydromt_wflow/data/parameters_data.yml
2025-08-18 13:40:55,860 - update - wflow - INFO - Supported Wflow.jl version v1+
2025-08-18 13:40:55,983 - update - wflow - INFO - Read grid from /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/wflow_piave_basin/staticmaps.nc
2025-08-18 13:40:56,532 - update - wflow - INFO - Reading model staticgeom files.
2025-08-18 13:40:56,570 - update - wflow - INFO - Read forcing from /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/wflow_piave_basin/inmaps-era5-2010.nc
2025-08-18 13:40:56,588 - update - wflow - INFO - Reading model table files.
2025-08-18 13:40:56,588 - update - wflow - INFO - Model read
2025-08-18 13:40:56,592 - update - model_api - INFO - setup_allocation_areas.waterareas_fn: gadm_level2
2025-08-18 13:40:56,592 - update - model_api - INFO - setup_allocation_areas.priority_basins: True
2025-08-18 13:40:56,592 - update - model_api - INFO - setup_allocation_areas.minimum_area: 50.0
2025-08-18 13:40:56,592 - update - model_api - INFO - setup_allocation_areas.output_name: allocation_areas_admin2
2025-08-18 13:40:56,592 - update - wflow - INFO - Preparing water demand allocation map.
2025-08-18 13:40:56,595 - update - geodataframe - INFO - Reading gadm_level2 vector data from /home/runner/.hydromt_data/artifact_data/v0.0.9/data.tar/gadm_level2.gpkg
2025-08-18 13:40:56,714 - update - model_api - INFO - setup_allocation_surfacewaterfrac.gwfrac_fn: lisflood_gwfrac
2025-08-18 13:40:56,714 - update - model_api - INFO - setup_allocation_surfacewaterfrac.waterareas_fn: None
2025-08-18 13:40:56,714 - update - model_api - INFO - setup_allocation_surfacewaterfrac.gwbodies_fn: lisflood_gwbodies
2025-08-18 13:40:56,714 - update - model_api - INFO - setup_allocation_surfacewaterfrac.ncfrac_fn: lisflood_ncfrac
2025-08-18 13:40:56,714 - update - model_api - INFO - setup_allocation_surfacewaterfrac.interpolate_nodata: False
2025-08-18 13:40:56,714 - update - model_api - INFO - setup_allocation_surfacewaterfrac.mask_and_scale_gwfrac: True
2025-08-18 13:40:56,714 - update - model_api - INFO - setup_allocation_surfacewaterfrac.output_name: demand_surface_water_ratio
2025-08-18 13:40:56,714 - update - wflow - INFO - Preparing surface water fraction map.
2025-08-18 13:40:56,716 - update - rasterdataset - INFO - Reading lisflood_gwfrac raster data from /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/data/demand/lisflood_gwfrac.tif
2025-08-18 13:40:56,734 - update - rasterdataset - INFO - Reading lisflood_gwbodies raster data from /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/data/demand/lisflood_gwbodies.tif
2025-08-18 13:40:56,745 - update - rasterdataset - INFO - Reading lisflood_ncfrac raster data from /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/data/demand/lisflood_ncfrac.tif
2025-08-18 13:40:56,754 - update - wflow - INFO - Using wflow model allocation areas.
2025-08-18 13:40:56,925 - update - model_api - INFO - setup_lulcmaps_with_paddy.lulc_fn: glcnmo
2025-08-18 13:40:56,925 - update - model_api - INFO - setup_lulcmaps_with_paddy.paddy_class: 12
2025-08-18 13:40:56,925 - update - model_api - INFO - setup_lulcmaps_with_paddy.output_paddy_class: None
2025-08-18 13:40:56,925 - update - model_api - INFO - setup_lulcmaps_with_paddy.lulc_mapping_fn: None
2025-08-18 13:40:56,925 - update - model_api - INFO - setup_lulcmaps_with_paddy.paddy_fn: None
2025-08-18 13:40:56,925 - update - model_api - INFO - setup_lulcmaps_with_paddy.paddy_mapping_fn: None
2025-08-18 13:40:56,925 - update - model_api - INFO - setup_lulcmaps_with_paddy.soil_fn: soilgrids
2025-08-18 13:40:56,925 - update - model_api - INFO - setup_lulcmaps_with_paddy.wflow_thicknesslayers: [50, 100, 50, 200, 800]
2025-08-18 13:40:56,925 - update - model_api - INFO - setup_lulcmaps_with_paddy.target_conductivity: [None, None, 5, None, None]
2025-08-18 13:40:56,925 - update - model_api - INFO - setup_lulcmaps_with_paddy.lulc_vars: {&#39;landuse&#39;: None, &#39;vegetation_kext&#39;: &#39;vegetation_canopy__light-extinction_coefficient&#39;, &#39;land_manning_n&#39;: &#39;land_surface_water_flow__manning_n_parameter&#39;, &#39;soil_compacted_fraction&#39;: &#39;soil~compacted__area_fraction&#39;, &#39;vegetation_root_depth&#39;: &#39;vegetation_root__depth&#39;, &#39;vegetation_leaf_storage&#39;: &#39;vegetation__specific-leaf_storage&#39;, &#39;vegetation_wood_storage&#39;: &#39;vegetation_wood_water__storage_capacity&#39;, &#39;land_water_fraction&#39;: &#39;land~water-covered__area_fraction&#39;, &#39;vegetation_crop_factor&#39;: &#39;vegetation__crop_factor&#39;, &#39;vegetation_feddes_alpha_h1&#39;: &#39;vegetation_root__feddes_critial_pressure_head_h~1_reduction_coefficient&#39;, &#39;vegetation_feddes_h1&#39;: &#39;vegetation_root__feddes_critial_pressure_head_h~1&#39;, &#39;vegetation_feddes_h2&#39;: &#39;vegetation_root__feddes_critial_pressure_head_h~2&#39;, &#39;vegetation_feddes_h3_high&#39;: &#39;vegetation_root__feddes_critial_pressure_head_h~3~high&#39;, &#39;vegetation_feddes_h3_low&#39;: &#39;vegetation_root__feddes_critial_pressure_head_h~3~low&#39;, &#39;vegetation_feddes_h4&#39;: &#39;vegetation_root__feddes_critial_pressure_head_h~4&#39;}
2025-08-18 13:40:56,925 - update - model_api - INFO - setup_lulcmaps_with_paddy.paddy_waterlevels: {&#39;demand_paddy_h_min&#39;: 20, &#39;demand_paddy_h_opt&#39;: 50, &#39;demand_paddy_h_max&#39;: 80}
2025-08-18 13:40:56,925 - update - model_api - INFO - setup_lulcmaps_with_paddy.save_high_resolution_lulc: False
2025-08-18 13:40:56,925 - update - model_api - INFO - setup_lulcmaps_with_paddy.output_names_suffix: None
2025-08-18 13:40:56,925 - update - wflow - INFO - Preparing LULC parameter maps including paddies.
2025-08-18 13:40:56,927 - update - rasterdataset - INFO - Reading glcnmo raster data from /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/data/demand/glcnmo.tif
2025-08-18 13:40:56,937 - update - dataframe - INFO - Reading glcnmo_mapping_default csv data from /home/runner/work/hydromt_wflow/hydromt_wflow/hydromt_wflow/data/lulc/glcnmo_mapping.csv
2025-08-18 13:40:56,946 - update - landuse - INFO - Deriving landuse using nearest resampling (nodata=0).
2025-08-18 13:40:56,970 - update - landuse - INFO - Deriving vegetation_kext using average resampling (nodata=-999.0).
2025-08-18 13:40:56,987 - update - landuse - INFO - Deriving land_manning_n using average resampling (nodata=-999.0).
2025-08-18 13:40:57,003 - update - landuse - INFO - Deriving soil_compacted_fraction using average resampling (nodata=-999.0).
2025-08-18 13:40:57,019 - update - landuse - INFO - Deriving vegetation_root_depth using average resampling (nodata=-999.0).
2025-08-18 13:40:57,035 - update - landuse - INFO - Deriving vegetation_leaf_storage using average resampling (nodata=-999.0).
2025-08-18 13:40:57,051 - update - landuse - INFO - Deriving vegetation_wood_storage using average resampling (nodata=-999.0).
2025-08-18 13:40:57,067 - update - landuse - INFO - Deriving land_water_fraction using average resampling (nodata=-999.0).
2025-08-18 13:40:57,083 - update - landuse - INFO - Deriving vegetation_crop_factor using average resampling (nodata=-999.0).
2025-08-18 13:40:57,099 - update - landuse - INFO - Deriving vegetation_feddes_alpha_h1 using mode resampling (nodata=-999).
2025-08-18 13:40:57,169 - update - landuse - INFO - Deriving vegetation_feddes_h1 using average resampling (nodata=-999).
2025-08-18 13:40:57,187 - update - landuse - INFO - Deriving vegetation_feddes_h2 using average resampling (nodata=-999).
2025-08-18 13:40:57,204 - update - landuse - INFO - Deriving vegetation_feddes_h3_high using average resampling (nodata=-999).
2025-08-18 13:40:57,222 - update - landuse - INFO - Deriving vegetation_feddes_h3_low using average resampling (nodata=-999).
2025-08-18 13:40:57,240 - update - landuse - INFO - Deriving vegetation_feddes_h4 using average resampling (nodata=-999).
2025-08-18 13:40:57,290 - update - wflow - INFO - Different thicknesslayers requested, updating `soil_brooks_corey_c` parameter
2025-08-18 13:40:57,293 - update - rasterdataset - INFO - Reading soilgrids raster data from /home/runner/.hydromt_data/artifact_data/v0.0.9/data.tar/soilgrids/{variable}.tif
2025-08-18 13:40:57,679 - update - soilgrids - INFO - Adding soil_ksat_vertical_factor map
2025-08-18 13:40:58,743 - update - wflow - INFO - Dropping these variables, as they depend on the layer dimension: [&#39;soil_brooks_corey_c&#39;, &#39;layer&#39;]
2025-08-18 13:40:58,758 - update - model_api - INFO - setup_domestic_demand.domestic_fn: pcr_globwb
2025-08-18 13:40:58,758 - update - model_api - INFO - setup_domestic_demand.population_fn: ghs_pop_2015
2025-08-18 13:40:58,758 - update - model_api - INFO - setup_domestic_demand.domestic_fn_original_res: 0.5
2025-08-18 13:40:58,758 - update - model_api - INFO - setup_domestic_demand.output_names: {&#39;land~domestic__gross_water_demand_volume_flux&#39;: &#39;demand_domestic_gross&#39;, &#39;land~domestic__net_water_demand_volume_flux&#39;: &#39;demand_domestic_net&#39;}
2025-08-18 13:40:58,758 - update - wflow - INFO - Preparing domestic demand maps.
2025-08-18 13:40:58,762 - update - rasterdataset - INFO - Reading pcr_globwb netcdf data from /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/data/demand/pcr_globwb.nc
2025-08-18 13:40:58,782 - update - rasterdataset - INFO - Reading pcr_globwb netcdf data from /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/data/demand/pcr_globwb.nc
2025-08-18 13:40:58,801 - update - rasterdataset - INFO - Reading ghs_pop_2015 raster data from /home/runner/.hydromt_data/artifact_data/v0.0.9/data.tar/ghs_pop_2015.tif
2025-08-18 13:40:59,614 - update - model_api - INFO - setup_other_demand.demand_fn: pcr_globwb
2025-08-18 13:40:59,614 - update - model_api - INFO - setup_other_demand.variables: [&#39;industry_gross&#39;, &#39;industry_net&#39;, &#39;livestock_gross&#39;, &#39;livestock_net&#39;]
2025-08-18 13:40:59,614 - update - model_api - INFO - setup_other_demand.resampling_method: nearest
2025-08-18 13:40:59,614 - update - model_api - INFO - setup_other_demand.output_names: {&#39;land~industry__gross_water_demand_volume_flux&#39;: &#39;demand_industry_gross&#39;, &#39;land~industry__net_water_demand_volume_flux&#39;: &#39;demand_industry_net&#39;, &#39;land~livestock__gross_water_demand_volume_flux&#39;: &#39;demand_livestock_gross&#39;, &#39;land~livestock__net_water_demand_volume_flux&#39;: &#39;demand_livestock_net&#39;}
2025-08-18 13:40:59,614 - update - wflow - INFO - Preparing water demand maps for [&#39;industry_gross&#39;, &#39;industry_net&#39;, &#39;livestock_gross&#39;, &#39;livestock_net&#39;].
2025-08-18 13:40:59,617 - update - rasterdataset - INFO - Reading pcr_globwb netcdf data from /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/data/demand/pcr_globwb.nc
2025-08-18 13:40:59,806 - update - model_api - INFO - setup_irrigation.irrigated_area_fn: irrigated_area
2025-08-18 13:40:59,806 - update - model_api - INFO - setup_irrigation.irrigation_value: [1]
2025-08-18 13:40:59,806 - update - model_api - INFO - setup_irrigation.cropland_class: [11, 14, 20, 30]
2025-08-18 13:40:59,806 - update - model_api - INFO - setup_irrigation.paddy_class: [12]
2025-08-18 13:40:59,806 - update - model_api - INFO - setup_irrigation.area_threshold: 0.6
2025-08-18 13:40:59,806 - update - model_api - INFO - setup_irrigation.lai_threshold: 0.2
2025-08-18 13:40:59,806 - update - model_api - INFO - setup_irrigation.lulcmap_name: meta_landuse
2025-08-18 13:40:59,806 - update - model_api - INFO - setup_irrigation.output_names: {&#39;land~irrigated-paddy_area__count&#39;: &#39;demand_paddy_irrigated_mask&#39;, &#39;land~irrigated-non-paddy_area__count&#39;: &#39;demand_nonpaddy_irrigated_mask&#39;, &#39;land~irrigated-paddy__irrigation_trigger_flag&#39;: &#39;demand_paddy_irrigation_trigger&#39;, &#39;land~irrigated-non-paddy__irrigation_trigger_flag&#39;: &#39;demand_nonpaddy_irrigation_trigger&#39;}
2025-08-18 13:40:59,806 - update - wflow - INFO - Preparing irrigation maps.
2025-08-18 13:40:59,806 - update - rasterdataset - INFO - Reading irrigated_area raster data from /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/data/demand/irrigated_area.tif
2025-08-18 13:40:59,818 - update - demand - INFO - Preparing irrigated areas map for non paddy.
2025-08-18 13:40:59,844 - update - demand - INFO - Preparing irrigated areas map for paddy.
2025-08-18 13:40:59,869 - update - demand - INFO - Calculating irrigation trigger.
2025-08-18 13:40:59,936 - update - wflow - INFO - Write model data to /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/wflow_piave_water_demand
2025-08-18 13:40:59,976 - update - wflow - INFO - Write grid to /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/wflow_piave_water_demand/staticmaps.nc
2025-08-18 13:41:00,250 - update - wflow - INFO - Writing model staticgeom to file.
2025-08-18 13:41:00,345 - update - wflow - INFO - Write forcing file
2025-08-18 13:41:00,355 - update - wflow - INFO - Process forcing; saving to /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/wflow_piave_water_demand/inmaps-era5-2010.nc
[########################################] | 100% Completed | 100.54 ms
2025-08-18 13:41:00,465 - update - wflow - INFO - Writing model config to /home/runner/work/hydromt_wflow/hydromt_wflow/docs/_examples/wflow_piave_water_demand/wflow_sbm.toml
</pre></div></div>
</div>
<p>NOTE: The second catalog demand/data_catalog.yml points to additional data that are not available in the hydromt artifact_data catalog such as extracts of the glcnmo landuse or the pcrglobwb gridded demands.</p>
</section>
<section id="Looking-at-the-added-layers">
<h2>Looking at the added layers<a class="headerlink" href="#Looking-at-the-added-layers" title="Link to this heading">#</a></h2>
<p>To understand what layers have been added, we’ll plot the new layers below. To do the plotting, we first have to import the required python libraries:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hydromt_wflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">WflowModel</span>

<span class="n">mod</span> <span class="o">=</span> <span class="n">WflowModel</span><span class="p">(</span>
    <span class="n">root</span><span class="o">=</span><span class="s2">&quot;wflow_piave_water_demand&quot;</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r+&quot;</span><span class="p">,</span>
    <span class="n">data_libs</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;artifact_data&quot;</span><span class="p">,</span>
        <span class="s2">&quot;./data/demand/data_catalog.yml&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<section id="Landuse-and-rice-fields">
<h3>Landuse and rice fields<a class="headerlink" href="#Landuse-and-rice-fields" title="Link to this heading">#</a></h3>
<p>Additional new parameters have been added to the model for landuse such as:</p>
<ul class="simple">
<li><p><strong>crop_factor</strong>: crop factor map that is used to convert the reference PET to the crop specific evaporation</p></li>
<li><p><strong>h</strong> values: soil water pressure heads at which root water uptake is reduced (Feddes) [cm]. They are different for paddy and non paddy landuse types.</p></li>
</ul>
<p>For paddies, new maps have been added and soil parameters updated to allow water to pool at the surface. These are the Brooks Corey c maps and a new <strong>soil_ksat_vertical_factor</strong> map which is a factor used to multiply the vertical conductivity (ksat vertical) in order to allow for a layer with very low conductivity (for the paddy fields).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Paddy fields [-]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Crop factor [-]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Soil water pressure head h1 (Feddes) [cm]&quot;</span><span class="p">)</span>

<span class="n">rice</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;meta_landuse&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;meta_landuse&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">12</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;meta_landuse&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">nodata</span>
<span class="p">)</span>
<span class="n">rice</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;vegetation_crop_factor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;vegetation_feddes_h1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/_examples_update_model_water_demand_13_0.png" src="../_images/_examples_update_model_water_demand_13_0.png" />
</div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">soil_ksat_vertical_factor</span></code> map is added that adds a layer with very low vertical hydraulic conductivity in the cells with paddy irrigation. The target conductivity value can be set for each layer using the <code class="docutils literal notranslate"><span class="pre">target_conductivity</span></code> parameter, and sets a value for each layer in the wflow model (linked to the <code class="docutils literal notranslate"><span class="pre">wflow_thicknesslayer</span></code> parameter). See the figures below for an indication of these maps and their effect on the vertical conductivity.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;soil_ksat_vertical_factor for layer=0&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;soil_ksat_vertical_factor for layer=2&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Effect on kv&quot;</span><span class="p">)</span>

<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;soil_ksat_vertical_factor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">layer</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;soil_ksat_vertical_factor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">layer</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="c1"># Take the cumulative sum to get to the cumulative layers</span>
<span class="n">layers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s2">&quot;model.soil_layer__thickness&quot;</span><span class="p">))</span>
<span class="n">layers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="c1"># Add layers to figure</span>
<span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;0.8&quot;</span><span class="p">)</span>

<span class="c1"># Position of a paddy pixel</span>
<span class="n">lat</span> <span class="o">=</span> <span class="mf">45.63</span>
<span class="n">lon</span> <span class="o">=</span> <span class="mf">12.66</span>

<span class="c1"># Read required layers</span>
<span class="n">kv_0</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;soil_ksat_vertical&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
<span class="n">soil_ksat_vertical_factor</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;soil_ksat_vertical_factor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;soil_f&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>

<span class="c1"># Compute original kv values (without soil_ksat_vertical_factor)</span>
<span class="n">depths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">original</span> <span class="o">=</span> <span class="n">kv_0</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">f</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">depths</span><span class="p">)</span>

<span class="c1"># Compute new kv values</span>
<span class="n">corrected</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">soil_ksat_vertical_factor</span><span class="o">.</span><span class="n">values</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">:</span>
    <span class="n">start_depth</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">end_depth</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">corrected</span><span class="p">[</span><span class="n">start_depth</span><span class="p">:</span><span class="n">end_depth</span><span class="p">]</span> <span class="o">*=</span> <span class="n">soil_ksat_vertical_factor</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">depths</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Without soil_ksat_vertical_factor&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">corrected</span><span class="p">,</span> <span class="n">depths</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With soil_ksat_vertical_factor&quot;</span><span class="p">)</span>

<span class="c1"># Flip y-axis for easier understanding of depth profile</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax3</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Vertical conductivity [mm day$^{-1}$]&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Depth below surface [mm]&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/_examples_update_model_water_demand_15_0.png" src="../_images/_examples_update_model_water_demand_15_0.png" />
</div>
</div>
</section>
<section id="Industry,-livestock-and-domestic-demand">
<h3>Industry, livestock and domestic demand<a class="headerlink" href="#Industry,-livestock-and-domestic-demand" title="Link to this heading">#</a></h3>
<p>For the non_irrigation related demand, we assume those to be already prepared datasets with gross and net (consumption) demands. In this example, we rely on data from the PCR-GLOBWB model. See the images below for an explanation of the data and added layers to the wflow model configuration.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">month</span> <span class="o">=</span> <span class="mi">6</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Demand values for month </span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Industry [mm/day]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Livestock [mm/day]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Domestic [mm/day]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Gross&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Net&quot;</span><span class="p">)</span>

<span class="c1"># Extracting the min-max ranges for consistent colorbars</span>
<span class="n">ind_min</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_industry_gross&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">ind_max</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_industry_gross&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">lsk_min</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_livestock_gross&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">lsk_max</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_livestock_gross&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">dom_min</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_domestic_gross&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">dom_max</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_domestic_gross&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="c1"># Plot industry</span>
<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_industry_gross&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">ind_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">ind_max</span>
<span class="p">)</span>
<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_industry_net&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">ind_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">ind_max</span>
<span class="p">)</span>
<span class="c1"># Plot livestock</span>
<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_livestock_gross&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">lsk_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">lsk_max</span>
<span class="p">)</span>
<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_livestock_net&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">lsk_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">lsk_max</span>
<span class="p">)</span>
<span class="c1"># Plot domestic (adjusted the max range to improve plotting)</span>
<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_domestic_gross&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">dom_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">dom_max</span> <span class="o">*</span> <span class="mf">0.3</span>
<span class="p">)</span>
<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_domestic_net&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">dom_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">dom_max</span> <span class="o">*</span> <span class="mf">0.3</span>
<span class="p">)</span>


<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/_examples_update_model_water_demand_17_0.png" src="../_images/_examples_update_model_water_demand_17_0.png" />
</div>
</div>
<p>In the figure above, we see a slight difference between the gross and net demand for the industry sector. This means that this sector consumes part of the demanded water, but returns a portion of the water back. On the other hand, the gross and net demands for both livestock and domestic are roughly the same, meaning that the majority of the water will be consumed.</p>
<p>For the industry and livestock sectors, we see the relatively low-resolution of the original data. This data is retrieved from the PCR-GLOBWB model, which was provided at a resolution of 0.5x0.5 degrees (roughly 40x40km). The same holds for the domestic demands data, but it was downscaled using population density in the <code class="docutils literal notranslate"><span class="pre">setup_non_irrigation</span></code> workflow (using the dataset provided in <code class="docutils literal notranslate"><span class="pre">population_fn</span></code>, which is an optional step). The population data is used to identify densely populated regions,
and downscales this to the cities/villages where the people actually live. To give an impression, see the figure below for an insight into the population data. Please note that this is the data at the original resolution of ~100x100m. The data at the wflow model resolution is provided in the staticmaps (see <code class="docutils literal notranslate"><span class="pre">mod.grid[&quot;Population_scaled&quot;]</span></code>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read original data and slice to model domain</span>
<span class="n">pop_ds</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_rasterdataset</span><span class="p">(</span>
    <span class="s2">&quot;ghs_pop_2015&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="n">mod</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="s2">&quot;basins&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="c1"># Get mask of catchment</span>
<span class="n">pop_ds_mask</span> <span class="o">=</span> <span class="n">pop_ds</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">geometry_mask</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="s2">&quot;basins&quot;</span><span class="p">])</span>
<span class="n">pop_ds</span> <span class="o">=</span> <span class="n">pop_ds</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pop_ds_mask</span><span class="p">)</span>

<span class="c1"># Plot data</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="c1"># Add original population data to figure</span>
<span class="n">pop_ds</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Population per pixel (~1000x1000m)&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="c1"># Add basin geometry to plot</span>
<span class="n">mod</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="s2">&quot;basins&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: &gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/_examples_update_model_water_demand_19_1.png" src="../_images/_examples_update_model_water_demand_19_1.png" />
</div>
</div>
</section>
<section id="Irrigation-maps">
<h3>Irrigation maps<a class="headerlink" href="#Irrigation-maps" title="Link to this heading">#</a></h3>
<p>For the <code class="docutils literal notranslate"><span class="pre">setup_irrigation</span></code> workflow, a number of maps have been added to the model:</p>
<ul class="simple">
<li><p><strong>demand_paddy_irrigated_mask</strong>: mask (0/1) of the cells that are considered to be paddy/rice fields</p></li>
<li><p><strong>demand_nonpaddy_irrigated_mask</strong>: mask (0/1) of the cells that are irrigated, but not paddy/rice fields</p></li>
<li><p><strong>demand_nonpaddy_irrigation_trigger</strong>: trigger (0/1) that indicates whether we expect irrigation to occur (based on the LAI, to identify the growing season)</p></li>
<li><p><strong>demand_paddy_irrigation_trigger</strong>: trigger (0/1) that indicates whether we expect irrigation to occur on paddies (based on the LAI, to identify the growing season)</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Paddy irrigation [-]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Non-paddy irrigation [-]&quot;</span><span class="p">)</span>

<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_paddy_irrigated_mask&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_nonpaddy_irrigated_mask&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/_examples_update_model_water_demand_21_0.png" src="../_images/_examples_update_model_water_demand_21_0.png" />
</div>
</div>
<p>In this figure, we see the cells with paddy (rice fields) and non-paddy irrigated areas. Cells are identified as such when they exceed a fractional threshold of the cell (set by <code class="docutils literal notranslate"><span class="pre">area_threshold</span></code>). A cell can only be either paddy-irrigated, non-paddy-irrigated, or rain-fed. In the third panel, we see the crop factor associated for all of the model pixels.</p>
<p>In the figures below, we show the irrigation trigger maps for three months: before the growing season, during the growing season, and in the closing stages of the growing season. A map with a mask (0/1) contains information whether irrigation is allowed to occur during this month.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Irrigation trigger [-]&quot;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;February&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;July&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;October&quot;</span><span class="p">)</span>

<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_nonpaddy_irrigation_trigger&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_nonpaddy_irrigation_trigger&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_nonpaddy_irrigation_trigger&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/_examples_update_model_water_demand_23_0.png" src="../_images/_examples_update_model_water_demand_23_0.png" />
</div>
</div>
</section>
<section id="Water-allocation-regions">
<h3>Water allocation regions<a class="headerlink" href="#Water-allocation-regions" title="Link to this heading">#</a></h3>
<p>To define regions where water can be shared and allocated, a merge between catchment and water areas or administrative boundaries is computed. These result in regions where wflow can allocate available water. No water allocation is supported between these regions. To give an impression on how these regions look like, see the following figures for an example.</p>
<p>Note: Water areas or regions are generally defined by sub-river-basins within a Country. In order to mimick reality, it is advisable to avoid cross-Country-border abstractions. Whenever information is available, it is strongly recommended to align the water regions with the actual areas managed by water management authorities, such as regional water boards.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read original data and slice to model domain</span>
<span class="n">admin</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">data_catalog</span><span class="o">.</span><span class="n">get_geodataframe</span><span class="p">(</span><span class="s2">&quot;gadm_level2&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="n">mod</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="s2">&quot;basins&quot;</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Allocation areas&quot;</span><span class="p">)</span>

<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;allocation_areas_admin2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">mod</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="s2">&quot;rivers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: title={&#39;center&#39;: &#39;Allocation areas&#39;}&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/_examples_update_model_water_demand_25_1.png" src="../_images/_examples_update_model_water_demand_25_1.png" />
</div>
</div>
<p>When merging the wflow basins with the water regions, some small subbasins can be created that do not contain river cells. These small basins will be merged to larger basins. When merging, you can decide if you prefer to merge with the nearest downstream basin, or with any basin in the same water region that does contain river using the <code class="docutils literal notranslate"><span class="pre">priotity_basins</span></code> argument. In the previous map, we gave priority to the basins, here is the results if priority is given to water regions instead:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create allocations areas</span>
<span class="n">mod</span><span class="o">.</span><span class="n">setup_allocation_areas</span><span class="p">(</span>
    <span class="n">waterareas_fn</span><span class="o">=</span><span class="s2">&quot;gadm_level2&quot;</span><span class="p">,</span>
    <span class="n">priority_basins</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Allocation areas&quot;</span><span class="p">)</span>

<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_allocation_area_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis_r&quot;</span>
<span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">mod</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="s2">&quot;rivers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: title={&#39;center&#39;: &#39;Allocation areas&#39;}&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/_examples_update_model_water_demand_27_1.png" src="../_images/_examples_update_model_water_demand_27_1.png" />
</div>
</div>
<p>Here we see a couple of distinct administrative boundaries (black lines), some of which already follow the catchment boundaries. When the catchment crosses an administrative boundary, that region receives a different but unique identifier. Note that we are using level 2 boundaries here, which might not be the most realistic for a region of this size.</p>
</section>
<section id="Surface-water-frac-used-for-water-allocation">
<h3>Surface water frac used for water allocation<a class="headerlink" href="#Surface-water-frac-used-for-water-allocation" title="Link to this heading">#</a></h3>
<p>By default, Wflow will allocate all water demands with water from the surface water (demand_surface_water_ratio=1). However, if in a certain areas, groundwater or other non conventional sources can be used, the demand_surface_water_ratio of each allocation area can be reduced and prepared using the <strong>setup_allocation_surfacewaterfrac</strong> method.</p>
<p>Here we used global data from GLOFAS (Lisflood) for the fraction of grounwater used, presence of groundwater bodies and non conventional sources (0 is Piave). The water allocations are the ones we prepared in the previous step in order to match better the wflow model basin delineation.</p>
<p>Let’s have a look at the resulting map:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Allocation surface water frac used&quot;</span><span class="p">)</span>

<span class="n">mod</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;demand_surface_water_ratio&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask_nodata</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">mod</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="s2">&quot;basins&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">mod</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="s2">&quot;rivers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: title={&#39;center&#39;: &#39;Allocation surface water frac used&#39;}&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/_examples_update_model_water_demand_30_1.png" src="../_images/_examples_update_model_water_demand_30_1.png" />
</div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="update_model_gauges.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Update a Wflow model: gauging stations</p>
      </div>
    </a>
    <a class="right-next"
       href="connect_to_1d_model.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Connect Wflow to a 1D model</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Update-the-wflow-model">Update the wflow model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Looking-at-the-added-layers">Looking at the added layers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Landuse-and-rice-fields">Landuse and rice fields</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Industry,-livestock-and-domestic-demand">Industry, livestock and domestic demand</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Irrigation-maps">Irrigation maps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Water-allocation-regions">Water allocation regions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Surface-water-frac-used-for-water-allocation">Surface water frac used for water allocation</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/Deltares/hydromt_wflow/edit/main/docs/_examples/update_model_water_demand.ipynb">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/_examples/update_model_water_demand.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright Deltares.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>